<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Customer Offer.Order</title>
</head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
<script src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script src="../lib/jquery.ui.touch.js"></script>
<script src="../lib/jquery.ui.touch-punch.min.js"></script>

<body>
<div id="offer_order" class="order_container"
     style="display:inline-block;   position: fixed;
     overflow-x: hidden; overflow-y: visible; z-index:2147483646; margin: auto;
       width:100%;  height: auto; left: 0%; top: 0%;
       border: solid 0px lightslategrey;
       box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);">
    <div data-translate="3e68ad9b7ced9994b62721c5af7c5fbc" hidden>Image</div>
    <div>
        <div>
            <style>
                .order-header{
                    padding:9px 15px;
                    border-bottom:1px solid #5e5e5e;
                    background-color: #0e0e0e;
                    -webkit-border-top-left-radius: 5px;
                    -webkit-border-top-right-radius: 5px;
                    -moz-border-radius-topleft: 5px;
                    -moz-border-radius-topright: 5px;
                    border-top-left-radius: 5px;
                    border-top-right-radius: 5px;
                    font-family: Arial, Helvetica, sans-serif;
                }
                .order-body{
                    position:sticky;
                    padding:9px 15px;
                    border-bottom:1px solid black;
                    border-top:1px solid black;
                    border-right:1px solid black;
                    border-left:1px solid black;
                    color: #ffffff;
                    background-color: black ;
                    -webkit-border-top-left-radius: 0px;
                    -webkit-border-top-right-radius: 0px;
                    -moz-border-radius-topleft: 0px;
                    -moz-border-radius-topright: 0px;
                    border-top-left-radius: 0px;
                    border-top-right-radius: 0px;
                }
                .order-footer {
                    padding: 9px 15px;
                    border-bottom: 1px solid black;
                    border-top: 0px;
                    color: #5e5e5e;
                    background-color: black;
                    -webkit-border-top-left-radius: 5px;
                    -webkit-border-top-right-radius: 5px;
                    -moz-border-radius-topleft: 5px;
                    -moz-border-radius-topright: 5px;
                    border-top-left-radius: 5px;
                    border-top-right-radius: 5px;
                }
                .comment{
                    text-align:left;
                    width: 100%;
                    color: red;
                    font-family:'Segoe Script';
                    font-size: large;
                    background-color: #0a0a0a
                }
                textarea:focus {
                    outline: none !important;
                    border-color: #719ECE;
                    box-shadow: 0 0 10px #719ECE;
                }
                .tab-content::-webkit-scrollbar {
                    width: 0 !important;
                }
                li {
                    float: left;
                }

                li a, .dropbtn {
                    display: inline-block;
                    color: white;
                    text-align: center;
                    padding: 14px 16px;
                    text-decoration: none;
                }

                li a:hover, .dropdown:hover .dropbtn {
                    background-color: red;
                }

                li.dropdown {
                    display: inline-block;
                }

                .dropdown-content {
                    display: none;
                    position: absolute;
                    background-color: #f9f9f9;
                    min-width: 160px;
                    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                    z-index: 1;
                }

                .dropdown-content a {
                    color: black;
                    padding: 12px 16px;
                    text-decoration: none;
                    display: block;
                    text-align: left;
                }

                .dropdown-content a:hover {background-color: #f1f1f1}

                .dropdown:hover .dropdown-content {
                    display: block;
                }
                textarea{
                    background-color: #0e0e0e;
                }
                [href=".tacollapse"]{
                    color: whitesmoke;
                    font-size: 30px;
                }
            </style>
            <div class="order-header" style="position: relative;color:white;width: 100%;">
                <div class="row" style="display: inline-block; width:95%;margin: 0 auto;">
                    <div class="col-sm-1 col-xs-1 dropdown">
                        <button class="btn btn-sm dropdown-toggle scaled"  data-toggle="dropdown"
                                data-width="fit" type="button" style="background-color: #0a0a0a">
                            <span class="glyphicon glyphicon-option-vertical" style="color:white; background-color: #0a0a0a !important;"></span>
                        </button>
                        <ul class="dropdown-menu order_menu_options menu_list">
                            <li class="supplier_profile" data-width="fit"><a href="#"
                                data-translate="ec136b444eede3bc85639fac0dd06229">Supplier</a></li>
                            <li class="cancel_order" data-width="fit"><a href="#"
                                data-translate="f479ee0428deb391dacad49e70199eb4">Cancel The Offer</a></li>
                        </ul>
                    </div>
                    <div class="col-sm-3 col-xs-3">
                        <div class="order_div" style="white-space: pre; text-align: center">Order for</div>
                    </div>
                    <div class="col-sm-6 col-xs-6">
                        <div data-translate="884d9804999fc47a3c2694e49ad2536a" style="text-align: center; color:white">Адрес доставки</div>
                        <!--<label  for="address">Адрес:</label>-->
                        <div>
                            <textarea name="address" class="address form-control" rows="1" contenteditable="true"
                                      data-translate placeholder="Введите адрес доставки"
                                      style="text-align: center; background-color:black;color: #c4e3f3;border-color: #2b2b2b"></textarea>
                        </div>
                    </div>
                    <div class="col-sm-2 col-xs-2">

                    </div>
                </div>
                <div style="display: inline-block; position:absolute; right: 10px; padding-left: 20px;">
                    <span class="close_browser glyphicon glyphicon-remove-sign scaled"></span>
                </div>
                <div class="ord_status" style="position: absolute;right: 0;bottom: 0; font-size: x-small;"></div>
            </div>
            <div class="order-body">
                <div class="tab-content">
                    <ul class="nav nav-tabs menu_tabs">
                        <li class="add_tab_li" title="add tab" style="display: none;">
                            <span class="glyphicon glyphicon-plus-sign add_tab" data-toggle="tab"  href="#add_tab" style="position: relative;opacity: .5;font-size: 30px;padding:10px; "></span>
                            <!--<img id="add_tab" src="./images/ic_plus.png" style="opacity:.8;background-color: aliceblue;padding-left:20px;height: 25px">-->
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div class="tab-pane fade add_tab_div" style="border: none"></div>
                    </div>
                </div>
            </div>
            <div class="order-footer">
                <span class="fa fa-comment-o" data-toggle="collapse" href=".tacollapse"></span>
                <textarea  class="input collapse in tacollapse comment" style="text-align:left; width: 100%; color: #ff6d6b;
                    font-family:'Segoe Script'; font-size: large;border-color: #0f192a" data-translate placeholder="a38a2e843b153d64253d762e23696e17"></textarea>
            </div>
        </div>
    </div>

    <style>
        .menu_item{
            position: relative;
            border-radius: 5px;
            border: 1px solid #343434;
            margin-bottom: 5px;
            width: 100%;
        }
        #menu_item_tmplt {
            display: none;
        }
        .item_title:focus{
            outline: none !important;
            border-color: #719ECE;
            box-shadow: 0 0 10px #719ECE;
        }
        .item_title{

            width: 65%;
            font-family:'Courier New';
            font-size: x-large;
            word-wrap: break-word;
            z-index: 10;
        }
        .item_content{
            position:relative;
            height: 280px;
            padding: 5px;

        }
        .content_text{
            font-family:'Segoe Script';
            font-size: medium;
            /*height: 240px;*/
            /*width:100%;*/
            border-width: 0px;
            /*overflow:auto;*/
            user-select: none;
            -webkit-appearance: textarea;
            -webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
            -moz-box-sizing: border-box;    /* Firefox, other Gecko */
            box-sizing: border-box;         /* IE 8+ */
        }
        .image_div{
            position: absolute;
            padding:15px;
            right:0px;
            bottom:0;
        }
        .item_price{

            color: #0088bb;
            position: relative;
            font-weight:normal;
            font-size:24px;
            word-wrap:normal
        }
        .item_pack{

            color: #0088bb;
            position: relative;
            font-weight:normal;
            font-size:24px;
            word-wrap:normal
        }
        .qnty_div{

        }
        .qnty{

            color: #0088bb;
            position: relative;
            font-weight:normal;
            font-size:18px;
        }
        [contentEditable=true]:empty:not(:focus):before{
            content:attr(placeholder);
            color:gray;
        }

    </style>

    <div  id="menu_item_tmplt"   style="background-color: #262626">

        <div class="row" style="background-color: #262626; margin-right:5px; margin-left: 5px">
            <div class="col-xs-8">
                <div class="item_title" data-translate contentEditable="true" placeholder="название" data-toggle="collapse"></div>
            </div>

            <div class="col-xs-4 pack_container  row">
                <div class="col-xs-4">
                    <div class="dropdown-toggle"  data-toggle="dropdown">
                        <div style="display: inline-block" data-translate="41b0e839c21e82f25bffdb9dc82848fa"></div>
                        <span class="caret" style="display: inline-block;"></span>
                    </div>

                    <ul class="pack_list dropdown-menu" role="menu" aria-labelledby="menu2" data-width="fit"></ul>

                    <div class="item_pack input" contentEditable="true" placeholder="     гр."
                         style="font-weight:normal;font-size:24px;white-space: nowrap;"></div>

                </div>
                <div class="col-xs-4">
                    <div>Цена:</div>
                    <div class="input item_price"  contentEditable="true" placeholder="руб" style="font-weight:normal;font-size:24px;white-space: nowrap;"></div>
                </div>
                <div class="col-xs-2">
                    <div class="qnty_div" data-translate="ee4a528dce8d6fa440db5ab1cf78f939" style="white-space: nowrap;">Кол-во</div>
                    <div class="dropdown" style="text-align: center">
                        <button class="btn btn-sm btn-primary dropdown-toggle" type="button" data-toggle="dropdown"
                                style="font-size: large">0
                            <!--<span class="caret"></span>-->
                        </button>
                        <ul class="dropdown-menu scaled"  multiple>
                            <li><a href="#" role="qntyitem">0</a></li>
                            <li><a href="#" role="qntyitem">1</a></li>
                            <li><a href="#" role="qntyitem">2</a></li>
                            <li><a href="#" role="qntyitem">3</a></li>
                            <li><a href="#" role="qntyitem">4</a></li>
                            <li><a href="#" role="qntyitem">5</a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-xs-2">
                    <div class="ordperiod" style="white-space: nowrap;visibility: hidden">Время доставки</div>
                    <span class="appr_div fa fa-handshake-o approved scaled" style="display:block;position:absolute; top:30px; right:5px;font-size: 20px; visibility: hidden"></span>
                </div>
            </div>

        </div>

        <div class="item_content collapse">
            <div class="row">
                <div class="col-xs-10">
                    <div  class="input content_text" rows="20" placeholder="ef6f6a1c0e002ecd1063b3ee0ac9302d" data-translate contenteditable="true"></div>
                </div>
                <div class="col-xs-2"></div>
            </div>
            <div>
                <img class="input img-fluid w3-image" draggable="false"  src="" >
            </div>
            <div class="gallery" style="position: absolute;left: 0;bottom: 0"></div>
        </div>
    </div>

</div>
</body>
<script>
    //var $ = jQuery = window.parent.$;
    window.db = window.parent.db;
    window.user = window.parent.user;
    window.sys_dict = window.parent.sysdict;
    window.sets = window.parent.sets;
    window.SetData = function(obj,dict,md5){
        window.dict = dict;
        this.md5 = md5;
        this.obj = obj;
        let that = this;
        this.ovc = $('#offer_order');
        this.uid = obj.uid;
        this.profile = obj.profile;
        this.offer = obj.data;
        this.obj.supuid = obj.email;
        this.date = obj.date;
        let latlon = [obj.latitude,obj.longitude];

        window.user.map.geo.SearchPlace(latlon, 18, function (obj) {
            that.address = obj;
            $('.address').text(obj.city+ "," + obj.street + "," + obj.house);
        });
        $('.close_browser').on('click touchstart', this, function (ev) {
            let that = ev.data;
            that.SaveOrder(ev,window.sets.lang);
            that.offer = '';
            $(that.ovc).remove();
        });

        this.period = obj.period;

        window.sys_dict.set_lang(window.sets.lang,this.ovc[0]);

        this.ovc.find('.toolbar').css('display', 'block');

        this.ovc.find('li.publish_order').addClass('disabled');

        //this.ovc.draggable();
        //this.ovc.find('.modal-title-date').text($('.dt_val')[0].value.split(' ')[0]);

        $(this.ovc).find('.publish_order').off('click touchstart');
        $(this.ovc).find('.publish_order').on('click touchstart',this,function (ev) {
            let that = ev.data;
            let items = ev.data.GetOrderItems(ev.data.lang,true);
            window.user.PublishOrder(items,(data)=> {
                let status = window.dict.getDictValue(window.sets.lang,Object.keys(data)[1]);
                $(that.ovc).find('.ord_status').css('color','white');
                $(that.ovc).find('.ord_status').text(status + "\r\n"+ data.published);
                that.status = Object.keys(data)[1];

                window.db.GetSettings(function (obj) {
                    obj[0].address = items.address;
                    window.db.SetObject('setStore',obj[0], function () {

                    });
                });
            });
        });

        $(this.ovc).addTouch();

        $(this.ovc).find('.comment').on('click',this.ovc,function (ev) {
            $(ev.data).css('width','auto');
        });

//        let str = "Заказ на доставку\r\n"+$('.dt_val', window.parent)[0].value+"("+$('.sel_period', window.parent).text()+")";
//        this.ovc.find('.order_div').text(str);

        window.db.GetSettings(function (obj) {
            if(obj[0].profile && obj[0].profile.address)
                that.ovc.find('.address').text(obj[0].profile.address);
        });


        for (let tab in this.offer) {
            if(!tab || this.offer[tab].length===0) continue;
            if($('[href="#'+tab+'"]').length===0) {
                $('<li class="tab_inserted"><a data-toggle="tab"  contenteditable="false" data-translate="'+md5(tab)+'"  href="#'+tab+'">'+tab+'</a>' +
                    '</li>').insertBefore(this.ovc.find('.add_tab_li'));
                $('<div id="'+tab+'" class="tab-pane fade div_tab_inserted dropdown" style="border: none">' +
                    '</div>').insertBefore(this.ovc.find('.add_tab_div'));
            }

            for (let i in this.offer[tab]) {

                let menu_item  = $('#menu_item_tmplt').clone();
                $(menu_item).attr('id', tab + '_' + i);
                $(menu_item).attr("class", 'menu_item');
                $(menu_item).css('display', 'block');

                $(menu_item).find('.item_title').attr('contenteditable', 'false');
                //$(menu_item).find('.item_price').attr('contenteditable', 'true');//TODO:for premium tariff

                $(menu_item).find('.item_price').text(this.offer[tab][i].price);

                $(menu_item).find('.item_content').attr('id', 'content_' + tab + '_' + i);
                $(menu_item).find('.item_title').attr('data-target','#content_' + tab + '_' + i);

                if(this.offer[tab][i].title){
                    $(menu_item).find('.item_title').attr('data-translate', this.offer[tab][i].title);
                }

                if(this.offer[tab][i].packlist) {
                    $(menu_item).find('.pack_container').css('display','block').addClass('col-xs-4');
                    $.each(this.offer[tab][i].packlist, function (i, data) {
                        $(menu_item).find('.pack_list').append("<li href='#'><a role='packitem'>" + i + "</a></li>");
                        $(menu_item).find('.item_pack').text(i);
                        $(menu_item).find('.item_price').text(data);
                        $(menu_item).find('.item_pack').attr('packlist',JSON.stringify(data));
                    });
                }
                //$(menu_item).find('.content_text').text(urlencode.decode(window.dict.dict[this.menu[tab][i].content][window.sets.lang]));
                $(menu_item).find('.content_text').attr('contenteditable', 'false');
                $(menu_item).find('.content_text').attr('data-translate', this.offer[tab][i].content);
                if(this.offer[tab][i].content)
                    $(menu_item).find('.content_text').css('visibility','visible');
                if(this.offer[tab][i].width)-
                    $(menu_item).find('.content_text').css('width',(this.offer[tab][i].width));

                if(this.offer[tab][i].img) {
                    $(menu_item).find('.img-fluid').css('visibility', 'visible');
                    $(menu_item).find('.img-fluid').attr('src', this.offer[tab][i].img.src);
                    $(menu_item).find('.img-fluid').css('left',!this.offer[tab][i].img.left?0:this.offer[tab][i].img.left);
                    $(menu_item).find('.img-fluid').css('top', this.offer[tab][i].img.top);
                    this.MakeDraggable($(menu_item).find('.img-fluid'));
                }

                $(menu_item).find('.img-fluid').attr('id', 'img_' + tab + '_' + i);

                $(menu_item).find('.gallery').attr('id', 'gallery_' + tab + '_' + i);

                $.each(this.offer[tab][i].cert, function (i, data) {
                    let img = new Image();
                    img.src = data.src;
                    //$(img).offset(data.pos); TODO:
                    img.height = '50';
                    $(menu_item).find('.gallery').append(img);
                    $(img).on('click', that.onClickCert);
                });

                $('#offer_order').find('#' + tab).append(menu_item);
                //$(menu_item).insertAfter('#offer_order');

                if ($(menu_item).find('.item_content').css('display') == 'block'
                    && $(menu_item).find('.img-fluid').attr('src')===''
                    && $(menu_item).find('.content_text').text()===""){
                    $(menu_item).find('.item_content').slideToggle("fast");
                }

                $(menu_item).find('li>a[role=qntyitem]').on('click', function(ev){
                    that.changed = true;
                    $(menu_item).find('.btn').focus();
                    $(menu_item).find('.btn').text(ev.target.text).val();

                    $(menu_item).find('.btn').removeClass('btn-default');
                    $(menu_item).find('.btn').addClass('btn-success');
                    $(menu_item).attr('ordered', ev.target.text);

                });
                $(menu_item).find('li>a[role=packitem]').on('click', {that: that, off:this.offer[tab][i]},function(ev){
                    that.changed = true;
                    let pl = ev.data.off.packlist;
                    $(menu_item).find('.item_pack').text($(ev.target).text());
                    $(menu_item).find('.item_price').text(pl[$(ev.target).text()]);
                });
            }
        }

        //this.RedrawOrder(obj);

        this.dict.set_lang(window.sets.lang,this.ovc[0]);
        // $($(sp).find('[lang='+window.sets.lang+']')[0]).prop("selected", true).trigger('change');

        $($('.tab_inserted')[0]).find('a').trigger('click');

        window.db.GetOrders(this.date,obj.uid,function (arObj) {
            if(arObj.length>0){
                for(let o in arObj) {
                    let order = arObj[o];
                    that.address = order.address;
                    if (!that.address) {
                        window.user.map.geo.SearchPlace(latlon, 18, function (obj) {
                            that.address = obj;
                            $('.address').text(obj.street + "," + obj.house);
                        });
                    } else {
                        if(that.address)
                            $('.address').text(that.address);
                    }

                    if(order.published) {
                        that.published = order.published;
                        let status = window.dict.getDictValue(window.sets.lang, "published");
                        $(that.ovc).find('.ord_status').css('color', 'white');
                        $(that.ovc).find('.ord_status').text(status + " "+order.published);
                    }

                    if(order.comment){
                        $(that.ovc).find('.comment').text(that.dict.getDictValue(window.sets.lang, order.comment));
                    }

                }
                if($('.menu_item[ordered]')[0])
                    $('li.publish_order.disabled').removeClass('disabled');
            }
        });

        $(this.ovc).find('.supplier_profile').on('click touchstart',function () {
            $('.browser_container').css('display','block');
        });

    }

    function MakeDraggable(el){
        $(el).draggable({
            start: function () {
                console.log("drag start");
            },
            drag: function () {
                return false;//$(el).attr('drag', true);
            },
            stop: function () {
                // var rel_x = parseInt($(el).position().left / window.innerWidth * 100);
                // $(el).css('right', rel_x + '%');
                // var rel_y = parseInt($(el).position().top / window.innerHeight * 100);
                // $(el).css('bottom', rel_y + '%');
            }
        });
    }
    function RedrawOrder(obj){
        let that = this;
        window.db.GetOrder(this.date, obj.uid, window.user.uid, function (res) {
            if(res!==-1){
                let keys = Object.keys(res.data);
                //$('.sel_period').text(res.period);
                for(let k in keys){
                    if(keys[k]==='comment'){
                        $('.comment').text(that.dict.getDictValue(window.user.lang, res.data.comment));
                    }else {
                        window.db.GetApproved(that.date,obj.uid,window.user.uid,keys[k],function (appr) {
                            if(appr &&
                                //res.period ===appr.period &&
                                res.data[keys[k]].price===appr.data.price &&
                                res.data[keys[k]].pack===appr.data.pack &&
                                res.data[keys[k]].qnty===appr.data.qnty) {
                                $('.item_title[data-translate=' + keys[k] + ']').closest('.row').find('.ordperiod').text(appr.period );
                                $('.item_title[data-translate=' + keys[k] + ']').closest('.row').find('.appr_div').attr('approved', that.date);
                                $('.item_title[data-translate=' + keys[k] + ']').closest('.row').find('.appr_div').css('visibility', 'visible');
                                $('.item_title[data-translate=' + keys[k] + ']').closest('.row').find('.ordperiod').css('visibility', 'visible');
                            }
                        });

                        let qnty = res.data[keys[k]].qnty;
                        $('.item_title[data-translate=' + keys[k] + ']').closest('.row').find('button').text(qnty);
                        let price = res.data[keys[k]].price;
                        $('.item_title[data-translate=' + keys[k] + ']').closest('.row').find('.item_price').text(price);
                        let pack = res.data[keys[k]].pack;
                        $('.item_title[data-translate=' + keys[k] + ']').closest('.row').find('.item_pack').text(pack);
                        $('.item_title[data-translate='+keys[k]+']').closest('.menu_item').attr('ordered','');
                    }
                }
            }

            $('.menu_item').find('li').on('click', function (ev) {
                this.changed = true;
                if($(ev.target).text()!=='0'){
                    $(this).closest('.menu_item').attr('ordered',$(ev.target).text());
                    $('li.publish_order.disabled').removeClass('disabled');
                }else{
                    $(this).closest('.menu_item').removeAttr('ordered');
                    if($('.menu_item[ordered]')[0]) {
                        $('li.publish_order.disabled').removeClass('disabled');
                    }else{
                        $('li.publish_order').addClass('disabled');
                    }
                }
            })
        });
    }
    function onClickCert(ev) {
        ev.preventDefault();
        ev.stopPropagation();
        if(!$(this).attr('height'))
            $(this).attr('height','50');
        else {
            $(this).removeAttr('height');
        }
        return false;
    };




    function GetOrderItems(){
        let that = this;
        let obj = {data:{}};
        $('.menu_item[ordered]').each(function (index, val) {
            if($(this).attr('ordered')==='0'){
                return;
            }
            obj.data[$(val).find('.item_title').attr('data-translate')] = {
                qnty: $(val).find('button[data-toggle=dropdown]').text(),
                price: $(val).find('.item_price').text(),
                pack: $(val).find('.item_pack').text()
            }

        });

        if($('#offer_order_clone').find('.comment')[0])
            obj['comment'] = $('#offer_order_clone').find('.comment')[0].value;
        obj['supuid'] = this.uid;
        obj['cusuid'] = window.user.uid;
        obj['date'] = this.date;
        obj['period'] = $('.sel_period').text();
        obj['address'] = $('#offer_order_clone').find('.address').val();
        obj['published'] = this.published;

        return obj;
    }

    function SaveOrder(ev, lang) {

        let that = ev.data;

        let items = this.GetOrderItems();
        window.user.UpdateOrderLocal( items );

        window.user.PublishOrder(items, (data) => {
            let status = window.dict.getDictValue(window.sets.lang, Object.keys(data)[1]);
            $(that.ovc).find('.ord_status').css('color', 'white');
            $(that.ovc).find('.ord_status').text(status + "\r\n" + data.published);
            that.status = Object.keys(data)[1];
            window.db.GetSettings(function (obj) {
                obj[0].address = items.address;
                window.db.SetObject('setStore', obj[0], function () {

                });
            });
        });
    }
</script>
</html>